This is the folder containing the data for our study.

## Content

* `raw`: the folder containing all the raw reflectance spectra. See README inside for more information.
* `master_database.csv`: this is a table with the identity and additional information for all the lizards captured in the field. `RGR`, identifier for each lizard; `FieldTag`, another identifier; `Date`, data at which the individual was measured; `Island`, the island the lizard belongs to; `Locale`, which locality on the island; `Habitat`, which habitat the lizard belongs to; `lat`, latitude; `long`, longitude; `Sex`, M for male and F for female (JUV M for juvenile male); `Mass`, the mass of the lizard in grams; `note`, additional information when applicable.
* `reflectance.csv`: the processed and curated reflectance profiles used in the analyses. This file was produced by running the script `01_process_data.R` in `../scripts`. In brief, this script used the `getspec` function from R package `pavo` to read the raw spectral data files (reducing them to one value every nanometer between 300 and 700nm), then fetched metadata about each reflectance profile in `master_database.csv` (using tags in the reflectance file names) and assembled the output in a table where each row is a reflectance profile and columns represent the data and the associated metadata. Then, we only kept the data for dewlap centers (spot = 2) of males from the coastal (beach scrub in our manuscript), coppice and mangrove habitats. Finally, we processed the reflectance spectra using utilities provided in `pavo` as well as custom functions to increase signal-to-noise ratio (see below). `wl300` to `wl700`, reflectance at each wavelength (in percents); `tag`, the name of each reflectance file; `fieldtag`, the field tag of each lizard (same as `FieldTag` in `master_database.csv`); `code`, the RGR number of each lizard (same as `RGR` in `master_database.csv`); `island`, the island of each lizard; `habitat`, the habitat of each lizard; `locale`, the locality each lizard came from within its island; `latitude`; `longitude`; `sex`; `notes`, additional information; `spot`, where on the dewlap the measurement was taken (1 = throat, 2 = center, 3 = edge, >3 for other spots, which we did not consider); `specimen`, another individual identifier consisting of `island` and `fieldtag` pasted together). Note that we modified some entries in order to count some small males for which dewlap center was not available but was hard to discern from dewlap edge or throat (we used either of those in place of dewlap center for these individuals, see script). Also note that a few outliers were removed (the data with and without those outliers can be viewed in the figures generated by the script, see script).
* `counts.csv`: the number of lizards in each habitat on each island in our processed data (`reflectance.csv`). This table was produced by the script `02_run_analyses.R`.
* `sites.csv`: mean principal components (PC) for each site on each island, where the PC were computed from the processed data (`reflectance.csv`) within each island separately (see manuscript). Only the first four within-island PCs (wPC) are reported. This table was produced by the script `02_run_analyses.R`.
* `island_coordinates.csv`: bounding boxes of the various islands used to generate the maps in our figures (using the script `make_maps.R` in `../maps`).

## Processing

Processing of the raw spectral data involved four steps. 
First, we corrected some artifacts identified on some islands (Bimini and Cayman Brac) as spikes of reflectance at around 550 and 615nm, affecting all individuals on these islands.
To do so we linearized the portion of the spectra between 540 and 560nm, and between 600 and 630nm, using a local regression algorithm (the Gaussian `loess.smooth` function from R package `stats` with degree 1).
To correct for the steep slopes produced by the noisy edges of the linearized portions we re-linearized the corrected spectra, this time between 539 and 561nm and between 599 and 631nm (see the figures produced by the script `01_process_data.R` that show these steps).
Second, we fixed the negative reflectance values (mostly due to noise) by clamping them to zero.
Third, we smoothed the spectra using the recommended `procspec` function from `pavo` with span 0.5.
Fourth, as smoothing produced new slightly negative values, we repeated the second step and re-clamped negative values to zero.
The raw and processed data as well as all the processing steps can be visualized in the figures produced by the script `01_process_data.R`, which were saved in the folder `../results/processing`.

## Disclaimer

These data were archived on [Dryad](https://datadryad.org), separately from the scripts used to process and analyze them (`../scripts`). 
Hence, if you found this README on Dryad please be aware that the accompanying scripts were written as part of a broader repository (available at [https://github.com/rscherrer/dewlap](https://github.com/rscherrer/dewlap)) with a specific folder structure.
For example, the scripts should be run from a working directory that contains the present `data` directory as well as a `results` folder containing specific sub-folders where the scripts are supposed to save tables and figures to.
Simply running the scripts outside of their original repository may not work, or you may have to update the paths in the scripts to make them work. 
